<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Kalkulačka spotřeby chemické malty | Fischer</title>
  <meta name="description" content="Kalkulačka spotřeby chemické malty podle logiky výrobce Fischer. Výpočet objemu na 1 kotvu, celku s rezervou, počet kotev na 1 kartuši, počet kartuší + objednací čísla.">

  <style>
    html,body{margin:0;padding:0}
    body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;color:#111;background:#fff;line-height:1.5}
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    h2{color:#222;margin:24px 0 12px;line-height:1.25;font-size:1.4rem}
    p,li{margin-bottom:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:860px){.grid{grid-template-columns:repeat(2,1fr)}}
    label{display:block;font-weight:600;margin-bottom:6px}
    input[type=number],select{
      width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #ccc;border-radius:8px;font-size:1rem;background:#fff
    }
    .card{border:1px solid #e6e6e6;border-radius:12px;padding:16px;background:#fff;box-shadow:0 1px 6px rgba(0,0,0,.06)}
    .result{margin-top:16px;border-top:1px dashed #ddd;padding-top:16px}
    .result-list{display:grid;grid-template-columns:1fr;gap:8px}
    @media(min-width:680px){.result-list{grid-template-columns:repeat(2,1fr)}}
    .stat{padding:12px;background:#f8f8f8;border-radius:8px;border:1px solid #eee}
    .stat .val{font-size:1.25rem;font-weight:700}
    .muted{color:#666;font-size:.92rem}
    .order{background:#f5f9ff;border:1px solid #d9e8ff;padding:12px;border-radius:8px}
    .hidden{display:none}
    .small{font-size:.9rem}
    .order a{ text-decoration:none; border-bottom:1px dotted #6da2ff; }
    .order a:hover{ border-bottom-style:solid; }
  </style>

  <!-- DŮLEŽITÉ: načti mapu synchronně (globální proměnná window.URL_MAP) -->
  <script src="url-map.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2>Zadání</h2>

      <div class="grid">
        <div>
          <label for="pouziti">Použití</label>
          <select id="pouziti"></select>
        </div>

        <div id="sitkoRow" class="hidden">
          <label for="sitko">Sítko</label>
          <select id="sitko"></select>
        </div>

        <div>
          <label for="sroub">Kotevní prvek</label>
          <select id="sroub"></select>
        </div>

        <div>
          <label for="prumer">Průměr vrtaného otvoru (mm)</label>
          <select id="prumer"></select>
        </div>

        <div>
          <label for="hloubka">Hloubka vrtání (mm)</label>
          <input id="hloubka" type="number" min="10" step="1" value="250"/>
        </div>

        <div>
          <label for="kotev">Počet kotev (ks)</label>
          <input id="kotev" type="number" min="1" step="1" value="10"/>
        </div>

        <div>
          <label for="kartuse">Volba kartuše</label>
          <select id="kartuse"></select>
        </div>

        <div>
          <label for="rezerva">Rezerva</label>
          <select id="rezerva">
            <option>0 %</option>
            <option>5 %</option>
            <option selected>10 %</option>
            <option>15 %</option>
            <option>20 %</option>
            <option>25 %</option>
            <option>30 %</option>
          </select>
        </div>
      </div>

      <div class="result" aria-live="polite">
        <div class="result-list">
          <div class="stat">
            <div class="muted">Objem malty na 1 kotvu</div>
            <div class="val"><span id="objem1">–</span></div>
          </div>
          <div class="stat">
            <div class="muted">Celkový objem malty + rez.</div>
            <div class="val"><span id="objem">–</span></div>
          </div>
          <div class="stat">
            <div class="muted">Počet kotev na 1 kartuši</div>
            <div class="val"><span id="pocet">–</span></div>
          </div>
          <div class="stat">
            <div class="muted">Požadovaný počet kartuší</div>
            <div class="val"><span id="kartusi">–</span></div>
          </div>
        </div>

        <div class="order" style="margin-top:12px">
          <strong>Objednací čísla</strong>
          <div id="objednavka" class="small muted">—</div>
        </div>

        <p class="muted small" style="margin-top:12px">
          <strong>Upozornění:</strong> dodržujte certifikované kotevní hloubky a technologické postupy dle technického listu. Skutečná spotřeba se může lišit vlivem podkladu a postupu montáže.
        </p>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const $ = id => document.getElementById(id);
      const setOptions = (sel, arr) => { sel.innerHTML = arr.map(v => `<option>${v}</option>`).join(''); };
      const preserveSelect = (sel, arr, prefer=null) => {
        const prev = sel.value;
        setOptions(sel, arr);
        if (prefer && arr.includes(prefer)) sel.value = prefer;
        else if (arr.includes(prev)) sel.value = prev;
        else sel.selectedIndex = 0;
      };
      const fmtMl = v => `${Math.round(v)} ml`;
      const fmtKs = v => `${Math.round(v)} ks`;
      const rodArea = d => Math.PI * Math.pow(d/2, 2);
      const escapeHtml = (s='') => s.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&gt;','>':'&gt;','"':'&quot;'}[c]));

      const POUZITI = [
        'Kotevní šroub v plném materiálu - bez sítka',
        'Kotevní šroub v děrovaném zdivu - se sítkem',
        'Kotevní šroub v pórobetonu - kuželový otvor s PBB',
        'Kotevní pouzdro s vnitřním závitem',
        'Betonářská výztuž',
        'FHB II-AL',
        'FHB II-AS'
      ];

      const KARTUSE = {
        'FIS VL 300': {V:280, cat:'538583'},
        'FIS VL HIGHSPEED 300': {V:280, cat:'538585'},
        'FIS VL 410': {V:390, cat:'538584'},
        'FIS VL HIGHSPEED 410': {V:390, cat:'538586'},
        'FIS V Zero': {V:280, cat:'562064'},
        'FIS V 360': {V:340, cat:'43994'},
        'FIS V Plus 360': {V:340, cat:'558762'},
        'FIS VW 360': {V:340, cat:'43997'},
        'FIS VW Plus 360': {V:340, cat:'558768'},
        'FIS P 300': {V:280, cat:'51061'},
        'FIS EM Plus 390': {V:370, cat:'544176'},
        'FIS EM Plus 585': {V:565, cat:'544165'},
        'FIS EM Plus 1500': {V:1470, cat:'544167'},
        'FIS HB 360 S': {V:340, cat:'562660'},
        'FIS SB 390': {V:370, cat:'520555'},
        'FIS SB 585': {V:565, cat:'520526'},
      };

      const SROUB_FULL = {
        'M8': {d0:10, St:36.6}, 'M10':{d0:12, St:58}, 'M12':{d0:14, St:84.3},
        'M16':{d0:18, St:157}, 'M20':{d0:24, St:245}, 'M24':{d0:28, St:353}, 'M30':{d0:35, St:561},
      };

      const SITKA = [
        'FIS H 12x50 K','FIS H 12x85 K','FIS H 16x85 K','FIS H 16x130 K','FIS H 20x85 K','FIS H 20x130 K','FIS H 20x200 K',
        'FIS H 12x1000 L','FIS H 16x1000 L','FIS H 22x1000 L','UPM-SH 30X1000 L'
      ];
      const SITKO_MAP = {
        'FIS H 12x50 K':   {cat:'41900', d0:12, h:55,  V1:10000, sroub:'M6-M8', L:false},
        'FIS H 12x85 K':   {cat:'41901', d0:12, h:90,  V1:20000, sroub:'M6-M8', L:false},
        'FIS H 16x85 K':   {cat:'41902', d0:16, h:90,  V1:24000, sroub:'M8-M10', L:false},
        'FIS H 16x130 K':  {cat:'41903', d0:16, h:135, V1:30000, sroub:'M8-M10', L:false},
        'FIS H 20x85 K':   {cat:'41904', d0:20, h:90,  V1:30000, sroub:'M12-M16', L:false},
        'FIS H 20x130 K':  {cat:'46703', d0:20, h:135, V1:50000, sroub:'M12-M16', L:false},
        'FIS H 20x200 K':  {cat:'46704', d0:20, h:205, V1:80000, sroub:'M12-M16', L:false},
        'FIS H 12x1000 L': {cat:'50598', d0:12, h:null, V1_per_mm:240,  sroub:'M6-M8',  L:true},
        'FIS H 16x1000 L': {cat:'50599', d0:16, h:null, V1_per_mm:280,  sroub:'M10-M12', L:true},
        'FIS H 22x1000 L': {cat:'45301', d0:22, h:null, V1_per_mm:400,  sroub:'M12-M16', L:true},
        'UPM-SH 30X1000 L':{cat:'645',   d0:30, h:null, V1_per_mm:520,  sroub:'M16-M24', L:true},
      };

      const POUZDRA = {
        'RG 8 x 75 M5 I':   {cat:'48221', d0:10, h:75,  V1:6000},
        'RG 10 x 75 M6 I':  {cat:'48222', d0:12, h:75,  V1:6000},
        'RG 12 x 90 M8 I':  {cat:'50552', d0:14, h:90,  V1:6000},
        'RG 16 x 90 M10 I': {cat:'50553', d0:18, h:90,  V1:8000},
        'RG 18 x 125 M12 I':{cat:'50562', d0:20, h:125, V1:12000},
        'RG 22 x 160 M16 I':{cat:'50563', d0:24, h:160, V1:16000},
        'RG 28 x 200 M20 I':{cat:'50564', d0:32, h:200, V1:48000},
      };

      function updateUI(){
        const pouziti = $('pouziti').value;
        const sS = $('sroub'), pS = $('prumer');
        const sitkoRow = $('sitkoRow'), sitkoSel = $('sitko');
        const hI = $('hloubka');

        sitkoRow.classList.add('hidden');
        sS.disabled = pS.disabled = hI.disabled = false;

        if (pouziti === 'Kotevní šroub v plném materiálu - bez sítka'){
          preserveSelect(sS, Object.keys(SROUB_FULL));
          preserveSelect(pS, [String(SROUB_FULL[sS.value].d0)]); pS.disabled = true;

        } else if (pouziti === 'Kotevní šroub v děrovaném zdivu - se sítkem'){
          sitkoRow.classList.remove('hidden'); preserveSelect(sitkoSel, SITKA);
          const sit = SITKO_MAP[sitkoSel.value];
          preserveSelect(sS, ['M6-M8','M8-M10','M10-M12','M12-M16','M16','M16-M24'], sit.sroub);
          sS.disabled = true; preserveSelect(pS, [String(sit.d0)]); pS.disabled = true;
          if (sit.L){ hI.disabled = false; } else { hI.disabled = true; hI.value = String(sit.h); }

        } else if (pouziti === 'Kotevní šroub v pórobetonu - kuželový otvor s PBB'){
          preserveSelect(sS, ['M8','M10','M12']); preserveSelect(pS, []); pS.disabled = true;
          if (hI.value !== '75' && hI.value !== '95') hI.value = '75';

        } else if (pouziti === 'Kotevní pouzdro s vnitřním závitem'){
          preserveSelect(sS, Object.keys(POUZDRA)); const it = POUZDRA[sS.value];
          preserveSelect(pS, [String(it.d0)]); pS.disabled = true; hI.value = String(it.h); hI.disabled = true;

        } else if (pouziti === 'Betonářská výztuž'){
          const bars = ['ø8','ø10','ø12','ø14','ø16','ø20','ø22','ø24','ø25','ø26','ø28','ø30','ø32','ø34','ø36','ø40'];
          preserveSelect(sS, bars);
          let pr = []; switch(sS.value){
            case 'ø8':pr=[10,12];break; case 'ø10':pr=[12,14];break; case 'ø12':pr=[14,16];break;
            case 'ø14':pr=[18];break; case 'ø16':pr=[20];break; case 'ø20':pr=[25];break;
            case 'ø22':pr=[30];break; case 'ø24':pr=[30];break; case 'ø25':pr=[30];break;
            case 'ø26':pr=[35];break; case 'ø28':pr=[35];break; case 'ø30':pr=[40];break;
            case 'ø32':pr=[40];break; case 'ø34':pr=[40];break; case 'ø36':pr=[45];break; case 'ø40':pr=[55];break;
          }
          preserveSelect(pS, pr.map(String)); pS.disabled = pr.length === 1;

        } else if (pouziti === 'FHB II-AL'){
          const FHB_AL = {
            'M8x60':{d0:10,h:75,V1:6000}, 'M10x95':{d0:12,h:110,V1:10000},
            'M12x100':{d0:14,h:115,V1:14000}, 'M12x120':{d0:14,h:135,V1:14000},
            'M16x125':{d0:18,h:140,V1:22000}, 'M16x145':{d0:18,h:160,V1:26000},
            'M16x160':{d0:18,h:175,V1:26000}, 'M20x210':{d0:25,h:235,V1:66000},
            'M24x210':{d0:25,h:235,V1:66000},
          };
          preserveSelect(sS, Object.keys(FHB_AL)); const it = FHB_AL[sS.value];
          preserveSelect(pS, [String(it.d0)]); pS.disabled = true; hI.value = String(it.h); hI.disabled = true;
          window._FHB_AL = FHB_AL;

        } else if (pouziti === 'FHB II-AS'){
          const FHB_AS = {
            'M10x60':{d0:10,h:75,V1:6000}, 'M10x75':{d0:10,h:90,V1:8000},
            'M12x75':{d0:12,h:90,V1:8000}, 'M16x95':{d0:16,h:110,V1:16000},
            'M20x170':{d0:25,h:190,V1:52000}, 'M24x170':{d0:25,h:190,V1:52000},
          };
          preserveSelect(sS, Object.keys(FHB_AS)); const it = FHB_AS[sS.value];
          preserveSelect(pS, [String(it.d0)]); pS.disabled = true; hI.value = String(it.h); hI.disabled = true;
          window._FHB_AS = FHB_AS;
        }
      }

      function linkFor(code, fallbackText){
        // Použij globální mapu, když je k dispozici; jinak čistý text (bez Google fallbacku).
        const rec = (window.URL_MAP && window.URL_MAP[String(code)]) ? window.URL_MAP[String(code)] : null;
        if(rec && rec.url){
          const name = (rec.name && rec.name.trim()) ? rec.name.trim() : fallbackText;
          const text = escapeHtml(name);
          const href = escapeHtml(rec.url);
          return `<a href="${href}" target="_blank" rel="noopener" title="${text}">${text}</a>`;
        }
        return escapeHtml(fallbackText);
      }

      function calc(){
        const pouziti = $('pouziti').value;
        const hloubka = parseFloat($('hloubka').value) || 0;
        const kotev = Math.max(1, parseInt($('kotev').value,10) || 1);
        const rez = (parseInt($('rezerva').value,10) || 0) / 100 + 1;
        const kText = $('kartuse').value;
        const kart = KARTUSE[kText];
        let V1_ml = 0, katalogSitko = '', sitekKs = 0;

        if (pouziti === 'Kotevní šroub v plném materiálu - bez sítka'){
          const s = SROUB_FULL[$('sroub').value];
          V1_ml = ( (Math.PI*Math.pow(s.d0/2,2)) - s.St ) * hloubka / 1000;

        } else if (pouziti === 'Kotevní šroub v děrovaném zdivu - se sítkem'){
          const sit = SITKO_MAP[$('sitko').value];
          if (sit.L){ const h = Math.max(1, Math.round(hloubka)); V1_ml = (sit.V1_per_mm*h)/1000; const per = Math.max(1, Math.floor(1000/h)); sitekKs = Math.ceil(kotev/per); }
          else { V1_ml = sit.V1/1000; sitekKs = kotev; }
          katalogSitko = sit.cat;

        } else if (pouziti === 'Kotevní šroub v pórobetonu - kuželový otvor s PBB'){
          V1_ml = (String(hloubka)==='95' ? 40000 : 30000)/1000;

        } else if (pouziti === 'Kotevní pouzdro s vnitřním závitem'){
          const it = POUZDRA[$('sroub').value]; V1_ml = it.V1/1000; katalogSitko = it.cat;

        } else if (pouziti === 'Betonářská výztuž'){
          const d0 = parseFloat($('prumer').value); const dia = parseFloat($('sroub').value.replace('ø','')) || 8;
          V1_ml = ( (Math.PI*Math.pow(d0/2,2)) - (Math.PI*Math.pow(dia/2,2)) ) * hloubka / 1000;

        } else if (pouziti === 'FHB II-AL'){
          const it = window._FHB_AL[$('sroub').value]; V1_ml = it.V1/1000;

        } else if (pouziti === 'FHB II-AS'){
          const it = window._FHB_AS[$('sroub').value]; V1_ml = it.V1/1000;
        }

        if (!isFinite(V1_ml) || V1_ml <= 0) V1_ml = 0;

        const V_total = kotev*V1_ml*rez;
        const pocet_na_kartusi = V1_ml>0 ? (kart.V / V1_ml / rez) : 0;
        const kartusi_need = V1_ml>0 ? Math.ceil(V_total / kart.V) : 0;

        $('objem1').textContent = fmtMl(V1_ml);
        $('objem').textContent  = fmtMl(V_total);
        $('pocet').textContent  = fmtKs(pocet_na_kartusi);
        $('kartusi').textContent= fmtKs(kartusi_need);

        // prokliknutelná objednávka
        let objednavka = '';
        const kartCode = kart.cat;
        const kartLink = linkFor(kartCode, kText);
        objednavka += (kartusi_need>0 ? `${kartusi_need}× ` : '') + `${kartLink} (${escapeHtml(kartCode)})`;

        if (pouziti === 'Kotevní šroub v děrovaném zdivu - se sítkem' && katalogSitko){
          const sitName = $('sitko').value;
          const sitLink = linkFor(katalogSitko, sitName);
          objednavka += `<br>${sitekKs}× ${sitLink} (${escapeHtml(katalogSitko)})`;
        }
        if (pouziti === 'Kotevní pouzdro s vnitřním závitem'){
          const it = POUZDRA[$('sroub').value];
          const pouzLink = linkFor(it.cat, $('sroub').value);
          objednavka += `<br>${kotev}× ${pouzLink} (${escapeHtml(it.cat)})`;
        }

        $('objednavka').innerHTML = objednavka;

        // výška pro rodiče (iframe bez prázdného místa)
        try {
          const h = Math.max(document.documentElement.scrollHeight, document.body?document.body.scrollHeight:0);
          parent.postMessage({type:'calcHeight', height:h}, '*');
        } catch(e){}
      }

      function init(){
        preserveSelect($('pouziti'), POUZITI);
        preserveSelect($('kartuse'), Object.keys(KARTUSE));
        $('pouziti').value = POUZITI[0];

        $('pouziti').addEventListener('change', ()=>{ updateUI(); calc(); });
        $('sitko').addEventListener('change',  ()=>{ updateUI(); calc(); });
        $('sroub').addEventListener('change',  ()=>{ updateUI(); calc(); });
        ['prumer','hloubka','kotev','kartuse','rezerva'].forEach(id=>{
          const el = $(id); el.addEventListener('input', calc); el.addEventListener('change', calc);
        });

        updateUI(); calc();
      }

      init();
    })();
  </script>
</body>
</html>
